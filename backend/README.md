# Backend

This is the backend used for the runepicker helper. It uses an [aiohttp](https://github.com/aio-libs/aiohttp)
web server and uses [socketio](https://socket.io/) to communicate with the connected
clients.

Setup the configuration in the [config folder](./config), create `netconfigDir`
and `modelsDir`, put your model configuration and model files in there and get started.
Make sure to use the models generated by [ml](../ml).

Then run `python3 index.py`.

For playing around with the backend api, you can use the javascript package in the [test folder](./test).
This folder also documents the api (althoug you might have to take a look in [index.py](./index.py))
to find the most up-to-date version. 

# API

The Socketio based API models the process used in our web app:

1. emit Event `startPrediction` with data `{ champion_id: number, lane: one of ["MARKSMEN", "SUPPORT", "MIDDLE", "TOP", "JUNGLE"]}`
2. receive Event `primaryStyles` with `{key: string -> value: number }` (prediction, higher is better)
3. emit event `selectPrimaryStyle` with the selected style
4. receive Event `primaryRunes` with `Array<{key: string -> value: number }>` where each array represents one perk group
5. emit Event `selectPrimaryRunes` with `Array<number>`
6. receive Event `subStyles` with data described in 2
7. emit Event `selectSubStyle` with data described in 3
8. receiveEvent `subRunes` with data described in 4

All endpoints use `/runeprediction` as the namespace.

All receive events send `{ success: boolean, data: data}` with data as described above. 
If `success` is `false`, `data` is a `string` with an error message (which might be non-informative). 
This should only happen if there's an internal server error (i.e. the request thread crashed).

All emitted events send a tuple `(success: boolean, msg: string | null)` to the socketio callback.
`success` is `false` if the input data was invalid. This is accompanied by an appropriate description.